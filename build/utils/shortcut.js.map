{"version":3,"sources":["../../src/utils/shortcut.js"],"names":["shortcutModel","id","conditions","includes","Promise","resolve","reject","database","models","model","findByPk","where","include","then","findWithCondition","deleted_at","findOne","name","findBy","condition","findAll","findAllWithCondition","label","user","find","role","username","full_name","password","create","subject","subject_name","color","role_name","event","startDate","Date","endDate","setDate","getDate","Op","between","start","startInterval","labelIds","findAllBy","labelId"],"mappings":"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","sourcesContent":["import { Op } from 'sequelize';\n\nimport { resetTime } from '../utils/date';\n\nimport database from '../database';\n\nclass shortcutModel {\n  /**\n   * Find a record by its id with the given conditions.\n   * @param {string} id The record id.\n   * @param {object} conditions The required conditions.\n   * @param {array} includes The models it should include.\n   * @returns An object.\n   */\n  static findWithCondition(id, conditions = {}, includes = []) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].findByPk(id, { where: conditions, include: includes }).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Find a record by its id.\n   * @param {string} id The record id.\n   * @param {array} includes The models it should include.\n   * @returns An object.\n   */\n  static find(id, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findWithCondition(id, { deleted_at: null }, includes).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Find a record by its id whether he is deleted or not.\n   * @param {string} id The record id.\n   * @param {array} includes The models it should include.\n   * @returns An object.\n   */\n  static findDeleted(id, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findWithCondition(id, includes).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Find a record by the given condition.\n   * @param {object} conditions The required conditions.\n   * @param {array} includes The models it should include.\n   * @returns An object.\n   */\n  static findBy(conditions, includes = []) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].findOne({ where: conditions, include: includes }).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Find a record by its name.\n   * @param {string} name The name of the record. (e.g. label > { label_name : 'name' })\n   * @param {array} includes The models it shoud include.\n   * @returns An object.\n   */\n  static findByName(name, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findBy({ [`${this.model}_name`]: name, deleted_at: null }, includes)\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Get all records with the given conditions.\n   * @param {object} conditions The required conditions.\n   * @param {array} includes The models it should include.\n   * @returns An array of objects.\n   */\n  static findAllWithCondition(condition, includes = []) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].findAll({ where: condition, include: includes }).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Get all the records which aren't deleted.\n   * @param {array} includes The models it should include.\n   * @returns An array of objects.\n   */\n  static findAll(includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findAllWithCondition({ deleted_at: null }, includes).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Get all the records whether they are deleted or not.\n   * @param {array} includes The models it should include.\n   * @returns An array of objects.\n   */\n  static findAllDeleted(includes = []) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].findAll({ include: includes }).then(resolve).catch(reject);\n    });\n  }\n}\n\nexport class label extends shortcutModel {\n  static get model() {\n    return 'label';\n  }\n}\n\nexport class user extends shortcutModel {\n  static get model() {\n    return 'user';\n  }\n\n  /**\n   * Find a user by its id and include its role.\n   * @param {string} id The user id.\n   * @param {array} includes The models it should include.\n   * @returns A user object.\n   */\n  static findWithRole(id, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.find(id, [database.models.role, ...includes])\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Find a user by its username.\n   * @param {string} username The user username.\n   * @param {array} includes The models it should include.\n   * @returns A user object.\n   */\n  static findByUsername(username, includes) {\n    return new Promise((resolve, reject) => {\n      this.findBy({ username: username, deleted_at: null }, includes).then(resolve).catch(reject);\n    });\n  }\n\n  /**\n   * Create a user.\n   * @param args The arguments provided to create the user. Must contain `username`, `full_name` and `password`.\n   * @returns The created user.\n   */\n  static create({ username, full_name, password }) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].create({ username, full_name, password }).then(resolve).catch(reject);\n    });\n  }\n}\n\nexport class subject extends shortcutModel {\n  static get model() {\n    return 'subject';\n  }\n\n  /**\n   * Create a subject.\n   * @param args The arguments provided to create the subject. Must contain `subject_name` and `color`.\n   * @returns The created user.\n   */\n  static create({ subject_name, color }) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].create({ subject_name, color }).then(resolve).catch(reject);\n    });\n  }\n}\n\nexport class role extends shortcutModel {\n  static get model() {\n    return 'role';\n  }\n\n  /**\n   * Create a role.\n   * @param args The arguments provided to create the role. Must contain `role_name`.\n   * @returns The created user.\n   */\n  static create({ role_name }) {\n    return new Promise((resolve, reject) => {\n      database.models[this.model].create({ role_name }).then(resolve).catch(reject);\n    });\n  }\n}\n\nexport class event extends shortcutModel {\n  static get model() {\n    return 'event';\n  }\n\n  /**\n   * Get the two week interval for the database request.\n   */\n  static get startInterval() {\n    const startDate = resetTime(new Date());\n    const endDate = new Date(new Date().setDate(new Date().getDate() + 14));\n\n    return { [Op.between]: [startDate, endDate] };\n  }\n\n  /**\n   * Get all the events which aren't deleted in the two weeks interval.\n   * @param {array} includes The models it should include.\n   * @returns An array of event objects.\n   */\n  static findAll(includes = []) {\n    const startDate = resetTime(new Date());\n    const endDate = new Date(new Date().setDate(new Date().getDate() + 14));\n\n    return new Promise((resolve, reject) => {\n      return this.findAllWithCondition({ start: { [Op.between]: [startDate, endDate] }, deleted_at: null }, includes)\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Get all the events which aren't deleted in the two weeks interval with the given conditions.\n   * @param {object} conditions The required conditions.\n   * @param {array} includes The models it should include.\n   * @returns An array of event objects.\n   */\n  static findAllBy(conditions, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findAllWithCondition({ ...conditions, start: this.startInterval, deleted_at: null }, includes)\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Get all the events where the label is in the given array which aren't deleted.\n   * @param {array} labelIds The array of labels ids.\n   * @param {array} includes The models it should include.\n   * @returns An array of event objects.\n   */\n  static findAllByLabelIds(labelIds, includes = []) {\n    return new Promise((resolve, reject) => {\n      this.findAllBy({ labelId: { [Op.in]: labelIds } }, includes)\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n}\n"],"file":"shortcut.js"}